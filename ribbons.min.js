;var Ribbons=function(i,t){"use strict";return{initWithOptions:function(i){this.curtainColor=i.curtainColor||"white",this.curtainOpacity=i.curtainOpacity||1,this.curtainSpeed=i.curtainSpeed||1,this.ribbonColorR=i.ribbonColorR||Math.floor(255*Math.random()),this.ribbonColorG=i.ribbonColorG||Math.floor(255*Math.random()),this.ribbonColorB=i.ribbonColorB||Math.floor(255*Math.random()),this.ribbonWidth=i.ribbonWidth||200,this.ribbonWidthSigma=i.ribbonWidthSigma||30,this.ribbonHeight=i.ribbonHeight||20,this.ribbonHeightSigma=i.ribbonHeightSigma||14,this.ribbonOpacity=i.ribbonOpacity||1,this.ribbonSpeed=i.ribbonSpeed||1,this.ribbonFrequency=i.ribbonFrequency||.2,this.ribbonStrokeColor=i.ribbonStrokeColor||"black",this.ribbonStrokeWidth=i.ribbonStrokeWidth||0,this.ribbonBorderRadius=i.ribbonBorderRadius||0,this.ribbonDirection=i.ribbonDirection||"right",this.colorSigma=i.colorSigma||30,this.easing=i.easing||t.Easings.EaseInOut,this.timeBeforeCurtainEnter=i.timeBeforeCurtainEnter||1500,this.zIndex=i.zIndex||1e3,this.setElement(i.selector)},setElement:function(n){i("#canvasPlaceholder").remove(),this.sel=n;var r=i(this.sel);this.offset=r.offset(),this.containerWidth=r.width(),this.containerHeight=r.height(),this.containerWidth+=parseInt(r.css("border-left-width"),10),this.containerWidth+=parseInt(r.css("border-right-width"),10),this.containerHeight+=parseInt(r.css("border-top-width"),10),this.containerHeight+=parseInt(r.css("border-bottom-width"),10);var o=i("<div/>",{id:"canvasPlaceholder"});o.css({position:"absolute",width:this.containerWidth,height:this.containerHeight,top:this.offset.top,left:this.offset.left}),i(document.body).append(o),this.stage=new t.Stage({container:"canvasPlaceholder",width:this.containerWidth,height:this.containerHeight}),this.curtain=new t.Rect({x:this.containerWidth,y:0,width:this.containerWidth,height:this.containerHeight,fill:this.curtainColor,opacity:this.curtainOpacity}),this.curtainLayer=new t.Layer,this.curtainLayer.add(this.curtain),this.stage.add(this.curtainLayer),this.ribbonLayer=new t.Layer,this.stage.add(this.ribbonLayer),this.setZIndex(this.zIndex)},setZIndex:function(t){this.zIndex=t,i(this.curtainLayer.getCanvas()._canvas).css({zIndex:t}),i(this.ribbonLayer.getCanvas()._canvas).css({zIndex:t+1})},isClear:function(){return this._ribbonsAreRunning||0!==this._ribbonCount?!1:!0},curtainSetLeft:function(){this.curtain.setX(-this.curtain.width()),this.curtainLayer.draw()},curtainSetRight:function(){this.curtain.setX(this.curtain.width()),this.curtainLayer.draw()},curtainToLeft:function(n){var r=this,o=new t.Tween({node:this.curtain,duration:this.curtainSpeed,x:-this.curtain.width(),y:0,easing:this.easing,onFinish:function(){i(r).trigger("curtain:Left"),"undefined"!=typeof n&&n()}});o.play()},curtainToRight:function(n){var r=this,o=new t.Tween({node:this.curtain,duration:this.curtainSpeed,x:this.curtain.width(),y:0,easing:this.easing,onFinish:function(){i(r).trigger("curtain:Right"),"undefined"!=typeof n&&n()}});o.play()},curtainToCenter:function(n){var r=this,o=new t.Tween({node:this.curtain,duration:1,x:0,y:0,easing:this.easing,onFinish:function(){i(r).trigger("curtain:Center"),"undefined"!=typeof n&&n()}});o.play()},randomSample:function(i,t){var n=Math.sqrt(-1*Math.log(Math.random())),r=2*Math.PI*Math.random(),o=Math.floor(n*Math.sin(r)*t+i);return 0>o?0:o},randomSampleClamp:function(i,t){var n=Math.sqrt(-1*Math.log(Math.random())),r=2*Math.PI*Math.random(),o=Math.floor(n*Math.sin(r)*t+i);return 0>o?0:o>255?255:o},sampleColor:function(){var i=this.randomSampleClamp(this.ribbonColorR,this.colorSigma),t=this.randomSampleClamp(this.ribbonColorG,this.colorSigma),n=this.randomSampleClamp(this.ribbonColorB,this.colorSigma);return"rgb("+i.toString()+","+t.toString()+","+n.toString()+")"},randomizeColorMus:function(){this.ribbonColorR=Math.floor(255*Math.random()),this.ribbonColorG=Math.floor(255*Math.random()),this.ribbonColorB=Math.floor(255*Math.random())},slideRibbon:function(){var i,n,r=this.randomSample(this.ribbonWidth,this.ribbonWidthSigma),o=this.randomSample(this.ribbonHeight,this.ribbonHeightSigma);"right"===this.ribbonDirection?(i=-1*(r+this.ribbonStrokeWidth),n=i+r+this.containerWidth+this.ribbonStrokeWidth):(i=r+this.ribbonStrokeWidth+this.containerWidth,n=i-2*r-this.containerWidth-this.ribbonStrokeWidth);var e=new t.Rect({x:i,y:this.containerHeight*Math.random(),width:r,height:o,fill:this.sampleColor(),stroke:this.ribbonStrokeWidth>0?this.ribbonStrokeColor:"",strokeWidth:this.ribbonStrokeWidth,cornerRadius:Math.min(this.ribbonBorderRadius,o/2,r/2),opacity:this.ribbonOpacity});this.ribbonLayer.add(e),this._ribbonCount++;var h=this,a=new t.Tween({node:e,duration:this.ribbonSpeed,x:n,y:e.y(),easing:this.easing,onFinish:function(){e.remove(),e.destroy(),h._ribbonCount--}});a.play()},startRibbons:function(){if(!this._ribbonsAreRunning){this._ribbonsAreRunning=!0,i(this).trigger("ribbons:Started");var t=this;this._ribbonTimerID=setInterval(function(){Math.random()>1-t.ribbonFrequency&&t.slideRibbon()},10)}},stopRibbons:function(){clearInterval(this._ribbonTimerID),this._ribbonsAreRunning=!1,i(this).trigger("ribbons:Stopped")}}}(jQuery,Kinetic,window);
